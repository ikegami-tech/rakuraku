<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>らくらくお部屋予約システム</title>
<link rel="icon" href="data:,">
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="loading">読み込み中...</div>

<div id="login-screen">
  <div class="login-box">
    <h2>予約システム v3.2</h2>
    <input type="text" id="loginId" placeholder="ユーザーID">
    <input type="password" id="loginPass" placeholder="パスワード">
    <button class="btn-primary" onclick="tryLogin()">ログイン</button>
  </div>
</div>

<div id="app-screen">
  <header>
    <div id="header-title">部屋予約</div>
    <div class="user-info">
      <span id="display-user-name"></span> さん
      <button onclick="logout()" style="width:auto; padding:5px 10px; font-size:0.7rem; margin-left:10px;">ログアウト</button>
    </div>
  </header>

  <div class="nav-tabs">
    <div class="nav-item" onclick="switchTab('map-view')">マップ検索</div>
    <div class="nav-item active" onclick="switchTab('timeline')">一覧(縦)</div>
    <div class="nav-item" onclick="switchTab('room-search')">部屋検索</div>
    <div class="nav-item" onclick="switchTab('logs')">履歴</div>
  </div>

  <div id="view-map-view" class="view-container">
    <div class="map-wrapper">
      <div class="map-container">
        <img src="YOUR_MAP_IMAGE_URL" alt="フロアマップ" class="map-image">

        <div class="map-click-area" data-room-id="meeting1" 
             style="top: 48%; left: 0%; width: 25%; height: 14%;"
             onclick="selectRoomFromMap(this)">
           <span>会議室1</span>
        </div>

        <div class="map-click-area" data-room-id="meeting2" 
             style="top: 62%; left: 0%; width: 25%; height: 21%;"
             onclick="selectRoomFromMap(this)">
           <span>会議室2</span>
        </div>

        <div class="map-click-area" data-room-id="reception6" 
             style="top: 0%; left: 45%; width: 25%; height: 30%;"
             onclick="selectRoomFromMap(this)">
           <span>応接室(6)</span>
        </div>

        <div class="map-click-area" data-room-id="reception8" 
             style="top: 0%; left: 70%; width: 30%; height: 35%;"
             onclick="selectRoomFromMap(this)">
           <span>応接室(8)</span>
        </div>

        <div class="map-click-area" data-room-id="private_mid" 
             style="top: 91%; left: 28%; width: 10%; height: 9%;"
             onclick="selectRoomFromMap(this)">
           <span>個室(中)</span>
        </div>

        <div class="map-click-area" data-room-id="private_corner" 
             style="top: 80%; left: 82%; width: 18%; height: 10%;"
             onclick="selectRoomFromMap(this)">
           <span>個室(角)</span>
        </div>

      </div>
      <p class="map-hint">予約したい部屋をクリックしてください</p>
    </div>
  </div>

  <div id="view-timeline" class="view-container active">
    <div class="date-controller">
      <button onclick="changeDate(-1, 'timeline-date')">&lt;</button>
      <input type="date" id="timeline-date" onchange="renderVerticalTimeline('all')">
      <button onclick="changeDate(1, 'timeline-date')">&gt;</button>
    </div>
    <div class="calendar-scroll-area">
      <div class="time-axis-col" id="time-axis-all"><div class="time-axis-header"></div></div>
      <div class="rooms-container" id="rooms-container-all"></div>
    </div>
    <button class="fab" onclick="openModal()">＋</button>
  </div>

  <div id="view-room-search" class="view-container">
    <div style="padding: 10px; background: #fff; border-bottom: 1px solid #ddd;">
      <div class="form-group" style="margin-top:0;">
        <label>部屋を選択</label>
        <select id="search-room-select" onchange="renderRoomSearch()"></select>
      </div>
      <div class="form-group">
        <label>日付を選択</label>
        <div style="display:flex; gap:10px;">
           <button onclick="changeDate(-1, 'search-date')">&lt;</button>
           <input type="date" id="search-date" onchange="renderRoomSearch()">
           <button onclick="changeDate(1, 'search-date')">&gt;</button>
        </div>
      </div>
    </div>
    <div class="calendar-scroll-area">
      <div class="time-axis-col" id="time-axis-single"><div class="time-axis-header"></div></div>
      <div class="rooms-container" id="rooms-container-single" style="flex:1;"></div>
    </div>
  </div>

  <div id="view-logs" class="view-container">
    <div class="log-wrapper">
      <h3>操作履歴 (最新20件)</h3>
      <table class="log-table">
        <thead><tr><th>日時</th><th>操作者</th><th>操作</th><th>詳細</th></tr></thead>
        <tbody id="log-tbody"></tbody>
      </table>
    </div>
  </div>
</div>

<div id="bookingModal" class="modal">
  <div class="modal-content">
    <h3 id="modal-title" style="margin-top:0;">新規予約</h3>
    <input type="hidden" id="edit-res-id">
    
    <div style="display:flex; gap:10px;">
        <div style="flex:1;"><label>部屋</label><select id="input-room"></select></div>
        <div style="flex:1;"><label>日付</label><input type="date" id="input-date"></div>
    </div>
    <div style="display:flex; gap:10px;">
      <div style="flex:1;"><label>開始</label><input type="time" id="input-start"></div>
      <div style="flex:1;"><label>終了</label><input type="time" id="input-end"></div>
    </div>
    
    <label>用件 (タイトル)</label>
    <input type="text" id="input-title" placeholder="定例会議など">
    <label>参加者設定</label>
    <div class="group-container" id="group-buttons-area"></div>
    
    <div class="shuttle-container">
        <div class="shuttle-box">
            <div class="shuttle-header">候補者一覧</div>
            <div class="shuttle-search">
                <input type="text" placeholder="名前検索..." id="shuttle-search-input" oninput="renderShuttleLists(this.value)">
            </div>
            <div class="shuttle-list" id="list-candidates"></div>
        </div>
        <div class="shuttle-box" style="background:#e3f2fd;">
            <div class="shuttle-header" style="background:#bbdefb;">参加予定者</div>
            <div class="shuttle-list" id="list-selected"></div>
        </div>
    </div>
    
    <label>備考</label>
    <textarea id="input-note" rows="2" placeholder="備品要望など"></textarea>

    <div style="display:flex; gap:10px; margin-top:20px;">
      <button type="button" onclick="closeModal()" style="background:#999; color:white;">キャンセル</button>
      <button type="button" id="btn-save" class="btn-primary" onclick="saveBooking()">保存</button>
      <button type="button" id="btn-delete" class="btn-danger" onclick="deleteBooking()" style="display:none;">削除</button>
    </div>
  </div>
</div>

<script src="script.js"></script>
</body>
</html>
